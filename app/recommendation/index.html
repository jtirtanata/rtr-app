<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Abel|Karla|Roboto|Roboto+Condensed" rel="stylesheet">
  <style>
  body {
    padding: 50px;
  }

  #results {
    padding-top: 30px;
    padding-left: 40px;
  }
  #results img{
    width: 200px;
    border-radius: 25px;
    border: 2px solid #dcc3e8;
    margin: 5px;
  }

  text.label {
    font-size: 12px;
    font-family: 'Roboto Condensed', sans-serif;
    fill: #6f6d6c;
  }

  rect {
    stroke: #f2e0f6;
    stroke-width: 3;
    fill: white;
  }

  rect.selected-input {
    fill: #f2e0f6;
  }



  </style>
</head>
<body>

<div class="container">
  <h1>INSERT TITLE</h1>
  <div id="input-squares">
  </div>
  <button onclick="fetchResults()" type="button" class="btn btn-default btn-block">
    Pick something for me
  </button>
  <div id="results" class="col-sm-10 col-sm-offset-1" >
  </div>
</div>

</body>
<script>
var selected = "rgb(176, 207, 136)"
var unselected = "rgb(224, 208, 227)";
selected_data = [];

fetchInputLabels();

function fetchInputLabels() {
  $.ajax({
   type: "GET",
   contentType: "application/json; charset=utf-8",
   url: "/labels",
   dataType: "json",
   async: true,
   success: function (data) {
     for (var i = 0; i < data.length; i++) {
       selected_data.push(0)
     }
     var width = 250;
     var height = 50;
     var gap = 15;
     var padding = 50;

     var svg = d3.select("div#input-squares").append("svg")
                .attr("width", (width + gap) * 4 + 50)
                .attr("height",(height + gap) * 2);
     var g = svg
             .selectAll("g")
             .data(data)
             .enter()
             .append("g")
             .attr("transform", function(d, i) {
               y = Math.floor(i/4) * (height + gap);
               x = i%4 * (width + gap) + padding;
               return "translate(" + x + "," + y+ ")";
             })
             .attr("index", function(d, i) {
               return i;
             })
             .attr("selected", 0)
             .on("click", function() {
               var ind = this.getAttribute("index");
               var isSelected = selected_data[ind] == 1;
               if (isSelected){
                 d3.select(this).select('rect')
                   .classed("selected-input", false);
                 selected_data[ind] = 0;
               } else {
                 d3.select(this).select('rect')
                  .classed("selected-input", true);
                 selected_data[ind] = 1;
               }
             });

     g.append("rect").attr("width", width)
       .attr("height", height)
       .text(function(d) {return d;})
       .classed("selected-input", false);

     g.append("text")
       .attr("class", "label")
       .attr("y", function(d, i) { return height/2 + 5; })
       .attr("x", function(d, i) { return 15; })
       .text(function(d) { return d; });
   },
   error: function (err) {
     console.log(err);
   }
 });
}
function fetchResults() {
  $.ajax({
   type: "POST",
   contentType: "application/json; charset=utf-8",
   url: "/rec",
   dataType: "json",
   async: true,
   data: "{\"inputs\": \"" + selected_data + "\"}",
   success: function (data) {
     displayResults(data);
   },
   error: function (err) {
     console.log(err);
   }
 });
}
result_holder = document.getElementById('results');
function displayResults(data){
  img = data['imgs'];
  for (var i = 0; i < img.length; i++) {
    img_el = document.createElement('img');
    img_el.src = img[i];
    result_holder.append(img_el);
  }
}

</script>
</html>
